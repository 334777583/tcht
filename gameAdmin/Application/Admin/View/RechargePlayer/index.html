<!DOCTYPE html>
<html>
    <head>
        <title>玩家充值统计</title>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
        <link href="__CSS__/skin.css" rel="stylesheet" type="text/css">
        <link href="__CSS__/jquery-ui.css" rel="stylesheet" type="text/css">
        <style type="text/css">
        <!--body {
            margin-left: 0px;
            margin-top: 0px;
            margin-right: 0px;
            margin-bottom: 0px;
            background-color: #EEF2FB;
            font-size: 12px;
        }
        -->
        </style>
    </head>
    <body>
        <div>
            <div>
                <div>
                    <table class="explain">
                        <thead>
                        </thead>
                        <tbody style="font-family:Mingliu">
                            <tr>
                                <td width="5%" class="tableleft">
                                    <b>说明：</b>
                                </td>
                            </tr>
							<tr>
                                <td width="95%" class="tableleft">
                                    1、统计玩家在游戏中所有的充值数据
                                </td>
                            </tr>
							<tr>
                                <td width="95%" class="tableleft">
                                    2、不支持模糊查询(必须正确填写搜索值)
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div class="topinfo">
                    <div>
                    <label>
                        <span>服务器:</span>
                        <select id="serverid">
                        	<volist name="serverList" id="sl">
                        		<option value="{$sl['g_id']}">{$sl['g_name']}</option>
                        	</volist>
                            <option value="0">全部</option>
                        </select>
                    </label>
                    <label>
                        <select id="condition">
                            <option value="0">角色名</option>
                            <option value="1">账号</option>
                            <option value="2">角色ID</option>
                        </select>
                    </label>
                    <label>
                    <input type="text" class="input1" id="searchvalue" value=""/>
                    </label>
					<input type="button" value="查询" id="query" style="margin-left:20px"/>
                </div>
            </div>
            <div style="clear:both">
            </div>
			<div id="tabs-10" class="tabitem">
                <div>
                    <table class="mytable" cellspacing="0" align="center" id="dtable0">
                        <thead>
                            <tr>
                                <th>账号</th>
                                <th>角色ID</th>
                                <th>角色名</th>
                                <th>服务器</th>
                                <th>充值元宝</th>
                                <th>Q点*游戏币*金券</th>
								<th>充值次数</th>
                            </tr>
                        </thead>
                        <tbody id="dtatr_body0">
                        </tbody>
                    </table>
                </div>
            </div>
            <div id="tabs-1" class="tabitem">
                <div>
                    <table class="mytable" cellspacing="0" align="center" id="dtable">
                        <thead>
                            <tr>
                                <th>服务器</th>
                                <th>ID</th>
                                <th>订单号</th>
                                <th>账号</th>
                                <th>角色ID</th>
                                <th>角色名</th>
                                <th>充值时间</th>
                                <th>充值元宝</th>
                                <th>Q点*游戏币*金券</th>
                                <th>渠道</th>
                            </tr>
                        </thead>
                        <tbody id="dtatr_body">
                        </tbody>
                    </table>
                    <div id="pagehtml" style="float:right;margin-right:20px">
                    </div>
                    <div id="example_length" class="dataTables_length" style="display:none">
                        <label>
                            每页显示
                            <select id="menu" name="example_length" size="1" aria-controls="example">
                                <option value="10">10</option>
                                <option value="25">25</option>
                                <option value="50" selected="selected">50</option>
                                <option value="100">100</option>
                            </select>
                            条记录
                        </label>
                    </div>
                </div>
            </div>
            <div style="clear:both">
            </div>
        </div>
        <div style="height:50px">
            &nbsp;
        </div>
        </div>
		
		<!-- 服务器 -->
        <div id="sform" style="display:none">
            <div class="ajaxform">
                <table width="100%" border="0" cellspacing="0" cellpadding="0" style="table-layout:fixed;">
				<tr>
					<td>
					<volist name="serverList" id="sld" key="k">
                        <if condition="$k%5 eq 0">
                            <br/>
                            <br/>
                        </if>
                        <input type="radio" name="db" value="{$sld['g_id']}" class="cbox" id="s{$k}"/>
                        <label for="s{$k}">
                            {$sld['g_name']}
                        </label>
                        <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
                    </volist>
					</td>
				</tr>
                </table>
            </div>
        </div>
		
        <script src="__STATIC__/jquery.js" type="text/javascript">
        </script>
        <script src="__JS__/jquery-ui.js" type="text/javascript">
        </script>
		<script src="__JS__/function.js" type="text/javascript">
        </script>
        <script type="text/javascript">
	        $(document).ready(function(){
				showTitle("充值数据分析:玩家充值统计");
				
				//全部服务器选项卡
                $("#serverid").change(function(){
                    if ($("#serverid").val() == 0) {
                        $("#sform").dialog({
                            height: 500,
                            width: 700,
                            buttons: {
                                "确认": function(){
                                    var item = $(':radio[name="db"]:checked').val();
                                    $("#serverid").val(item);
                                    $(this).dialog("close");
                                },
                                "关闭": function(){
                                    $(this).dialog("close");
                                }
                            }
                        })
                    }
                });
				
				$('#query').click(function(){
					show(1);
				});
				
                $("#menu").change(function(){
                    show(1);
                });
				
	        });
            
			function show(page){
				var searchvalue=$('#searchvalue').val();
				if(searchvalue==''){
					alert('必须填写搜索值');
					return false;
				}
				$.ajax({
                        type: 'POST',
                        url: '{:U("RechargePlayer/getData")}',
                        dataType: 'json',
                        data: {
                            serverid: $("#serverid").val(),
							condition:$('#condition').val(),
							searchvalue:searchvalue,
                            pageSize: $("#menu").val(),
                            curPage: page
                        },
                        beforeSend: function(){
							$("#dtatr_body0").html("<tr><td colspan='7'><img src='__IMG__/loading.gif'/></td></tr>");
                            $("#dtatr_body").html("<tr><td colspan='10'><img src='__IMG__/loading.gif'/></td></tr>");
                        },
                        success: function(data){
							if(data['status']==0){
								alert(data['info']);
							}
                            var result = data.result;
							var all = data.all;
							var serverList = data.serverList;
                            if (all!=null) {
                                var tbody = "";
                                for (var i in result) {
                                    tbody += "<tr>";
                                    tbody += "<td>" + serverList[result[i]["c_sid"]]['g_name'] + "</td>";
                                    tbody += "<td>" + result[i]["c_id"] + "</td>";
                                    tbody += "<td>" + result[i]["token_id"] + "</td>";
                                    tbody += "<td>" + result[i]["c_openid"] + "</td>";
                                    tbody += "<td>" + result[i]["c_pid"] + "</td>";
                                    tbody += "<td>" + result[i]["c_rolename"] + "</td>";
									tbody += "<td>" + result[i]["c_time"] + "</td>";
                                    tbody += "<td>" + result[i]["c_price"] * result[i]["c_num"] + "</td>";
                                    tbody += "<td>" + result[i]["c_amt"] + '*' + result[i]['payamt_coins'] + '*' + result[i]['pubacct_payamt_coins'] + "</td>";
                                    tbody += "<td>" + result[i]["c_pf"] + "</td>";
                                    tbody += "</tr>";
                                }
								
								var tbody0 = "";
                                for (var i in all) {
                                    tbody0 += "<tr>";
                                    tbody0 += "<td>" + all[i]["c_openid"] + "</td>";
                                    tbody0 += "<td>" + all[i]["c_pid"] + "</td>";
                                    tbody0 += "<td>" + all[i]["c_rolename"] + "</td>";
                                    tbody0 += "<td>" + serverList[all[i]["c_sid"]]['g_name'] + "</td>";
                                    tbody0 += "<td>" + all[i]["gold"] + "</td>";
                                    tbody0 += "<td>" + all[i]["amt"] + '*' + all[i]['coins'] + '*' + all[i]['coins1'] + "</td>";
                                    tbody0 += "<td>" + all[i]["count"] + "</td>";
                                    tbody0 += "</tr>";
                                }
								
								$("#dtatr_body0").html(tbody0);//插入查询得到的数据
                                $("#dtatr_body").html(tbody);//插入查询得到的数据
                                $("#dtatr_body tr:odd").css("background-color", "#e4eefa");
                                $("#pagehtml").html(data.pageHtml); //分页
                            	$("#example_length").show();//显示分页
                            }else {
								$("#example_length").hide();
                                $("#pagehtml").html("");
								$("#dtatr_body0").html("");
                                $("#dtatr_body").html("<tr><td colspan='10'>没有数据！</td></tr>");
                            }
                        },
                        error: function(){
							$("#example_length").hide();
                            $("#pagehtml").html("");
							$("#dtatr_body0").html("");
                            $("#dtatr_body").html("<tr><td colspan='10'>请求失败！</td></tr>");
                        }
                    });
			}
            
            //跳到相应页面 
            function go(){
                var pagenum = $("#page").val();
                if (pagenum == '' || isNaN(pagenum) || pagenum <= 0) {
                    alert('请输入一个正整数！');
                    $("#page").val(1);
                }else {
                    show(pagenum);
                }
            }
			
        </script>
    </body>
</html>
