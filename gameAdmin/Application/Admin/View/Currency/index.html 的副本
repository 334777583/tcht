<!DOCTYPE html>
<html>
    <head>
        <title>货币收支概况</title>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <link href="__CSS__/skin.css" rel="stylesheet" type="text/css">
        <link href="__CSS__/jquery-ui.css" rel="stylesheet" type="text/css">
        <style type="text/css">
        <!--body {
            margin-left: 0px;
            margin-top: 0px;
            margin-right: 0px;
            margin-bottom: 0px;
            background-color: #EEF2FB;
            font-size: 12px;
        }
        -->
        </style>
    </head>
    <body>
	<div>
		<div>
			<div>
				<table class="explain">
					<thead>
					</thead>
					<tbody style="font-family:Mingliu">
						<tr>
							<td width="5%"  class="tableleft"><b>说明：</b></td>
						</tr>
						<tr>
							<td width="95%" class="tableleft">1、查询区间内游戏中各种货币的收支概况图表；</td>
						</tr>
					</tbody>
				</table>
			</div>
			
			<div class="topinfo">
				<div>
					<span>服务器:</span>
					<select id="serverId">
						<volist name="serverList" id="sl">
						<option value="{$sl['g_id']}">{$sl['g_name']}</option>
						</volist>
						<option value="0">全部</option>
					</select>
					<input type="text" class="input1" id="startdate" />
					至<input type="text" class="input1" id="enddate" value="{$today}"/>
					<input type="button" value="查询" id="querybtn"/>
				</div>
			</div>
			
			<div style="clear:both"></div>
			
			<div id="tabs-1" class="tabitem">
				<div>
					<h1>铜钱收支概况</h1>
				</div>
				<div>
					<table width="100%" border="0" align="center" cellpadding="0" cellspacing="0" class="table_blue2">
						<tr>
							<td align="center" colspan="10" >
								<div id="copper_div" style="width: 100%; height: 400px;"></div>
							</td>
						</tr>
						<tr>
							<td>铜币产出:</td>
							<td id ="addtong"></td>
							<td>铜币消耗:</td>
							<td id ="usetong"></td>
							<td width="75%"></td>
						</tr>
					</table>
				</div>
				
			</div>
			
			<div id="tabs-2" class="tabitem">
				<div>
					<h1>绑定铜币收支概况</h1>
				</div>
				<div>
					<table width="100%" border="0" align="center" cellpadding="0" cellspacing="0" class="table_blue2">
						<tr>
							<td align="center" colspan="5">
								<div id="silver_div" style="width: 100%; height: 400px;"></div>
							</td>
						</tr>
						<tr>
							<td>绑定铜币产出:</td>
							<td id ="addbtong"></td>
							<td>绑定铜币消耗:</td>
							<td id ="usebtong"></td>
							<td width="75%"></td>
						</tr>
					</table>
					
				</div>
			</div>
			
			<div id="tabs-3" class="tabitem">
				<div>
					<h1>元宝收支概况</h1>
				</div>
				<div>
					<table width="100%" border="0" align="center" cellpadding="0" cellspacing="0" class="table_blue2">
						<tr>
							<td align="center" colspan="5">
								<div id="gold_div" style="width: 100%; height: 400px;"></div>
							</td>
						</tr>
						<tr>
							<td>元宝产出:</td>
							<td id ="addyuan"></td>
							<td>元宝消耗:</td>
							<td id ="useyuan"></td>
							<td width="75%"></td>
						</tr>
					</table>
					
				</div>
			</div>
			
			<div id="tabs-4" class="tabitem">
				<div>
					<h1>绑定元宝收支概况</h1>
				</div>
				<div>
					<table width="100%" border="0" align="center" cellpadding="0" cellspacing="0" class="table_blue2">
						<tr>
							<td align="center" colspan="5">
								<div id="bgold_div" style="width: 100%; height: 400px;"></div>
							</td>
						</tr>
						<tr>
							<td>绑定元宝产出:</td>
							<td id ="addbyuan"></td>
							<td>绑定元宝消耗:</td>
							<td id ="usebyuan"></td>
							<td width="75%"></td>
						</tr>
					</table>
					
				</div>
			</div>
			
			<div id="tabs-5" class="tabitem">
				<div>
					<h1>礼券收支概况</h1>
				</div>
				<div>
					<table width="100%" border="0" align="center" cellpadding="0" cellspacing="0" class="table_blue2">
						<tr>
							<td align="center" colspan="5">
								<div id="coupon_div" style="width: 100%; height: 400px;"></div>
							</td>
						</tr>
						<tr>
							<td>礼券产出:</td>
							<td id ="addcoupon"></td>
							<td>礼券消耗:</td>
							<td id ="usecoupon"></td>
							<td width="75%"></td>
						</tr>
					</table>
					
				</div>
			</div>
			
			<div style="clear:both"></div>
		</div>
		
	</div>
	
		<!--弹出覆盖层-->
	<div class="overlay" style="display: none">
		<table style="width: 220px; height: 100%; margin: 0 auto;">
			<tr>
				<td style="text-align: center">
					<img src='__IMG__/ajax-loader.gif' />
				</td>
			</tr>
		</table>
	</div>
	
		<!-- 服务器 -->
        <div id="sform" style="display:none">
            <div class="ajaxform">
                <table width="100%" border="0" cellspacing="0" cellpadding="0" style="table-layout:fixed;">
				<tr>
					<td>
					<volist name="serverList" id="sld" key="k">
                        <if condition="$k%5 eq 0">
                            <br/>
                            <br/>
                        </if>
                        <input type="radio" name="db" value="{$sld['g_id']}" class="cbox" id="s{$k}"/>
                        <label for="s{$k}">
                            {$sld['g_name']}
                        </label>
                        <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
                    </volist>
					</td>
				</tr>
                </table>
            </div>
        </div>
	
    <script src="__STATIC__/jquery.js" type="text/javascript">
    </script>
    <script src="__JS__/jquery-ui.js" type="text/javascript">
    </script>
    <script src="__JS__/function.js" type="text/javascript">
    </script>
	<script src="__STATIC__/amcharts/amcharts.js" type="text/javascript">
	</script>
	<script src="__STATIC__/amcharts/serial.js" type="text/javascript">
	</script>
	<script src="__STATIC__/chart-function.js" type="text/javascript">
	</script>
	<script type="text/javascript">
	$(document).ready(function(){
		//时间插件
		$("#startdate").datepicker();
		$("#enddate").datepicker();

		showTitle("货币相关查询:货币收支概况");
		
        $("#serverId").change(function(){
            if ($("#serverId").val() == 0) {
                $("#sform").dialog({
                    height: 500,
                    width: 700,
                    buttons: {
                        "确认": function(){
                            var item = $(':radio[name="db"]:checked').val();
                            $("#serverId").val(item);
                            $(this).dialog("close");
                        },
                        "关闭": function(){
                            $(this).dialog("close");
                        }
                    }
                })
            }
        });
        
    	$('#querybtn').click(function(){
    		getChartData();
    	});
        
	});	
	
	function getChartData(){
		$.ajax({
				type : 'POST',
				url : '{:U("Currency/getChartData")}',
				dataType : 'json',
				data : {
					serverId : $("#serverId").val(),
					startdate : $('#startdate').val(),
					enddate : $('#enddate').val()
				},
				beforeSend : function() {
					$('.overlay').show();
					$('.chartscontents').html("");
				},
				success : function(data) {
					$('.overlay').hide();
					var list = data.list;
					if (data.list != null && data.list != '') {
						for(var i in list){
							var html = "";
							html += '<div id="tabs-'+i+'" class="tabitem">';
							html += '<div>';
							html += '<h1>'+list[i]['name']+'收支概况</h1>';
							html += '</div>';
							html += '<div>';
							html += '<table width="100%" border="0" align="center" cellpadding="0" cellspacing="0" class="table_blue2">';
							html += '<tr>';
							html += '<td align="center" colspan="10" >';
							html += '<div id="chartdivid'+i+'" style="width: 100%; height: 400px;"></div>';
							html += '</td>';
							html += '</tr>';
							html += '<tr>';
							html += '	<td>'+list[i]['name']+'产出:</td>';
							html += '<td>'+list[i]['sum_increase']+'</td>';
							html += '	<td>'+list[i]['name']+'消耗:</td>';
							html += '<td>'+list[i]['sum_reduce']+'</td>';
							html += '<td width="75%"></td>';
							html += '</tr>';
							html += '</table>';
							html += '</div>';
							html += '</div>';
							$(".chartscontents").append(html);
							
							//showLine(list [i] ['data'], "chartdivid"+i, list [i] ['title'],'__PUBLIC__/Admin/images/');
							
							var chart;
	
	// this method is called when chart is first inited as we listen for "dataUpdated" event
    function zoomChart() {
        // different zoom methods can be used - zoomToIndexes, zoomToDates, zoomToCategoryValues
        chart.zoomToIndexes(10, 20);
    }
    
    AmCharts.ready(function () {

        // SERIAL CHART
        chart = new AmCharts.AmSerialChart();
        chart.pathToImages = imgpath;
        chart.dataProvider = list[i]['data'];
        chart.categoryField = "date";

        // listen for "dataUpdated" event (fired when chart is inited) and call zoomChart method when it happens
        chart.addListener("dataUpdated", zoomChart);

        // AXES
        // category
        var categoryAxis = chart.categoryAxis;
        categoryAxis.parseDates = true; // as our data is date-based, we set parseDates to true
        categoryAxis.minPeriod = "DD"; // our data is daily, so we set minPeriod to DD
        categoryAxis.minorGridEnabled = true;
        categoryAxis.axisColor = "#DADADA";
        categoryAxis.twoLineMode = true;
        categoryAxis.dateFormats = [{
             period: 'fff',
             format: 'JJ:NN:SS'
         }, {
             period: 'ss',
             format: 'JJ:NN:SS'
         }, {
             period: 'mm',
             format: 'JJ:NN'
         }, {
             period: 'hh',
             format: 'JJ:NN'
         }, {
             period: 'DD',
             format: 'DD'
         }, {
             period: 'WW',
             format: 'DD'
         }, {
             period: 'MM',
             format: 'MMM'
         }, {
             period: 'YYYY',
             format: 'YYYY'
         }];
        
        var color = ["#FF6600","#FCD202","#B0DE09","#ff8000","#ffff00","#ff00ff"];
        for(var i in title){
        	// first value axis (on the left)
            var valueAxis1 = new AmCharts.ValueAxis();
            valueAxis1.offset = (i-1)*20;
            valueAxis1.axisColor = color[i];
            valueAxis1.axisThickness = 2;
            valueAxis1.gridAlpha = 0;
            chart.addValueAxis(valueAxis1);
            
            // GRAPHS
            // first graph
            var graph1 = new AmCharts.AmGraph();
            graph1.valueAxis = valueAxis1; // we have to indicate which value axis should be used
            graph1.title = list [i] ['title'];
            graph1.valueField = list [i] ['title'];
            graph1.bullet = "round";
            graph1.hideBulletsCount = 30;
            graph1.bulletBorderThickness = 1;
            chart.addGraph(graph1);
        }
        
        // CURSOR
        var chartCursor = new AmCharts.ChartCursor();
        chartCursor.cursorAlpha = 0.1;
        chartCursor.fullWidth = true;
        chart.addChartCursor(chartCursor);

        // SCROLLBAR
        var chartScrollbar = new AmCharts.ChartScrollbar();
        chart.addChartScrollbar(chartScrollbar);

        // LEGEND
        var legend = new AmCharts.AmLegend();
        legend.marginLeft = 110;
        legend.useGraphSettings = true;
        chart.addLegend(legend);

        // WRITE
        chart.write('chartdivid');    });
							
						}
					} else {
						$(".chartscontents").html("没有数据！");
					}
				},
				error : function() {
					$(".chartscontents").html("请求失败！");
				}
			});
		}
	
	var chartData = [];
	function generateChartData() {
        var firstDate = new Date();
        firstDate.setDate(firstDate.getDate() - 50);

        for (var i = 0; i < 50; i++) {
            // we create date objects here. In your data, you can have date strings
            // and then set format of your dates using chart.dataDateFormat property,
            // however when possible, use date objects, as this will speed up chart rendering.
            var newDate = new Date(firstDate);
            newDate.setDate(newDate.getDate() + i);

            var visits = Math.round(Math.random() * 40) + 100;
            var hits = Math.round(Math.random() * 80) + 500;
            var views = Math.round(Math.random() * 6000);

            chartData.push({
                date: newDate,
                visits: visits,
                hits: hits,
                views: views
            });
        }
    }
	generateChartData();
	var title = new Array();
	title[0] = new Array();
	title[0]['title'] = 'aaa';
	title[0]['value'] = 'visits';
	//showLine(chartData, "chartdivid", title,'__PUBLIC__/Admin/images/');
	</script>
</body>
</html>