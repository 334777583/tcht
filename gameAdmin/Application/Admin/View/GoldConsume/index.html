<!DOCTYPE html>
<html>
    <head>
        <title>元宝消费比例</title>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <link href="__CSS__/skin.css" rel="stylesheet" type="text/css">
        <link href="__CSS__/jquery-ui.css" rel="stylesheet" type="text/css">
        <style type="text/css">
        <!--body {
            margin-left: 0px;
            margin-top: 0px;
            margin-right: 0px;
            margin-bottom: 0px;
            background-color: #EEF2FB;
            font-size: 12px;
        }
        -->
        </style>
    </head>
    <body>
	<div>
		<div>
			<div>
				<table class="explain">
					<thead>
					</thead>
					<tbody style="font-family:Mingliu">
						<tr>
							<td width="5%"  class="tableleft"><b>说明：</b></td>
						</tr>
						<tr>
							<td width="95%" class="tableleft">1、默认显示前一天的数据，注意：本功能暂只支持查询历史数据</td>
						</tr>
					</tbody>
				</table>
			</div>
			
			<div class="topinfo">
				<div>
					<span>服务器:</span>
					<select id="serverId">
						<volist name="serverList" id="sl">
						<option value="{$sl['g_id']}">{$sl['g_name']}</option>
						</volist>
						<option value="0">全部</option>
					</select>
					<span>日期:</span>
					<input type="text" class="input1" id="startdate" value="{$today}"/>
					至<input type="text" class="input1" id="enddate" value="{$today}"/>
					<input type="button" value="查询" id="history"/>
				</div>
			</div>
			<div style="clear:both"></div>
			
		</div>
		
		<div  style="border:1px solid #DDDBF2" >
				<div id="piediv" style="width: 100%; height: 500px;"></div>
		</div>
		
		<div style="height:50px">&nbsp;</div>
		
	</div>
	
		<!--弹出覆盖层-->
	<div class="overlay" style="display: none">
		<table style="width: 220px; height: 100%; margin: 0 auto;">
			<tr>
				<td style="text-align: center">
					<img src='__IMG__/ajax-loader.gif' />
				</td>
			</tr>
		</table>
	</div>
	
		<!-- 服务器 -->
        <div id="sform" style="display:none">
            <div class="ajaxform">
                <table width="100%" border="0" cellspacing="0" cellpadding="0" style="table-layout:fixed;">
				<tr>
					<td>
					<volist name="serverList" id="sld" key="k">
                        <if condition="$k%5 eq 0">
                            <br/>
                            <br/>
                        </if>
                        <input type="radio" name="db" value="{$sld['g_id']}" class="cbox" id="s{$k}"/>
                        <label for="s{$k}">
                            {$sld['g_name']}
                        </label>
                        <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
                    </volist>
					</td>
				</tr>
                </table>
            </div>
        </div>
	
    <script src="__STATIC__/jquery.js" type="text/javascript">
    </script>
    <script src="__JS__/jquery-ui.js" type="text/javascript">
    </script>
    <script src="__JS__/function.js" type="text/javascript">
    </script>
	<script src="__STATIC__/amcharts/amcharts.js" type="text/javascript">
	</script>
	<script src="__STATIC__/amcharts/pie.js" type="text/javascript">
	</script>
	<script src="__STATIC__/chart-function.js" type="text/javascript">
	</script>
    <script type="text/javascript">
        $(document).ready(function(){
            //时间插件
            $("#startdate").datepicker();
            $("#enddate").datepicker();
            
            showTitle("货币相关查询:元宝消费比例");
            
            $("#sip").change(function(){
                if ($("#sip").val() == 0) {
                    $("#dform").dialog({
                        height: 500,
                        width: 700,
                        buttons: {
                            "确认": function(){
                                var item = $(':radio[name="db"]:checked').val();
                                $("#sip").val(item);
                                $(this).dialog("close");
                            },
                            "关闭": function(){
                                $(this).dialog("close");
                            }
                        }
                    })
                }
            });
            
            $('#history').click(function(){
				var startdate = $('#startdate').val();
				var enddate= $("#enddate").val() ;
				if(enddate<startdate){
					alert('结束时间必须大于开始时间');
				}
            	$.ajax({
					type: 'POST',
					url: '{:U("GoldConsume/getChartData")}',
					dataType: 'json',
					data: {
						serverId: $("#serverId").val(),
						startdate: startdate,
						enddate:enddate
					},
					beforeSend: function(){
						$('.overlay').show();
						$("#piediv").html("");
					},
					success: function(data){
						$('.overlay').hide();
						if(data.list!=null&&data.list!=''){
							showSimplePie(data.list,'piediv');				
						}else {
							$("#piediv").html("没有数据！");
						}
					},
					error: function(){
						$("#piediv").html("没有数据！");
					}
				});
            });
            
        });
    </script>
</body>
</html>