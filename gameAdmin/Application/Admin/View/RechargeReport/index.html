<!DOCTYPE html>
<html>
    <head>
        <title>每日报表</title>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <link href="__CSS__/skin.css" rel="stylesheet" type="text/css">
        <link href="__CSS__/jquery-ui.css" rel="stylesheet" type="text/css">
        <style type="text/css">
        <!--body {
            margin-left: 0px;
            margin-top: 0px;
            margin-right: 0px;
            margin-bottom: 0px;
            background-color: #EEF2FB;
            font-size: 12px;
        }
        -->
        </style>
    </head>
    <body>
	<div>
		<div>
			<div>
				<table class="explain">
					<thead>
					</thead>
					<tbody style="font-family:Mingliu">
						<tr>
							<td width="5%"  class="tableleft"><b>说明：</b></td>
						</tr>
						<tr>
							<td width="95%" class="tableleft">1、ARPU=付费总额/付费人数</td>
						</tr>
						<tr>
							<td width="95%" class="tableleft">2、付费率=付费总额/上线人数</td>
						</tr>
						<tr>
							<td width="95%" class="tableleft">3、首充人数=第一次充值的用户数</td>
						</tr>
						<tr>
							<td width="95%" class="tableleft">4、所有数值以元宝计算</td>
						</tr>
						<tr>
							<td width="95%" class="tableleft">5、支持全部查询(全部查询时将不统计上线人数)</td>
						</tr>
					</tbody>
				</table>
			</div>
			
			<div class="topinfo">
				<div>
					<span>服务器:</span>
					<select id="serverId">
						<volist name="serverList" id="sl">
						<option value="{$sl['g_id']}">{$sl['g_name']}</option>
						</volist>
						<option value="0">全部</option>
					</select>
					<span>年份:</span>
					<select id="year">
						<for start="14" end="19">
							<option value='20{$i}'>20{$i}</option>
						</for>
					</select>
					<span>月份:</span>
					<select id="month">
						<for start="1" end="13">
							<if condition="$i eq 7">
								<option value='{$i}' selected="selected">{$i}</option>
							<else/>
								<option value='{$i}'>{$i}</option>
							</if>
						</for>
					</select>
					<input type="button" value="查询" id="jishi" style="margin-left:20px"/>
				</div>
			</div>
			
			<div style="clear:both"></div>
			
			<div id="tabs-1" class="tabitem">	
				<div>
					<table width="100%" cellspacing="0" align="center">
						<tr>
							<td>
								<table  class="mytable" cellspacing="0" align="center">
									<thead>
										<tr>
											<th>总元宝数</th>
											<th colspan="3" id="money">&nbsp;</th>
											<th>总金额</th>
											<th colspan="5" id="moneyother">&nbsp;</th>
										</tr>
										<tr>
											<th>日期</th>
											<th>首充人数</th>
											<th>首充元宝（Q点*游戏币*金券）</th>
											<th>首充ARPU</th>
											<th>上线人数</th>
											<th>充值人数</th>
											<th>充值次数</th>
											<th>元宝总数(Q点*游戏币*金券)</th>
											<th>ARPU</th>
											<th>付费率</th>
										</tr>
									</thead>
									<tbody id="dtatr_body">
									</tbody>
								</table>
							</td>
						</tr>
					</table>
					
				</div>
				
			</div>
			
			<div style="clear:both"></div>
		</div>
		
		<div style="height:50px">&nbsp;</div>
		
	</div>

		<!-- 服务器 -->
        <div id="sform" style="display:none">
            <div class="ajaxform">
                <table width="100%" border="0" cellspacing="0" cellpadding="0" style="table-layout:fixed;">
				<tr>
					<td>
					<volist name="serverList" id="sld" key="k">
                        <if condition="$k%5 eq 0">
                            <br/>
                            <br/>
                        </if>
                        <input type="radio" name="db" value="{$sld['g_id']}" class="cbox" id="s{$k}"/>
                        <label for="s{$k}">
                            {$sld['g_name']}
                        </label>
                        <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
                    </volist>
					</td>
				</tr>
                </table>
            </div>
        </div>
	
    <script src="__STATIC__/jquery.js" type="text/javascript">
    </script>
    <script src="__JS__/jquery-ui.js" type="text/javascript">
    </script>
    <script src="__JS__/function.js" type="text/javascript">
    </script>
	<script type="text/javascript">
	$(document).ready(function(){
		showTitle("充值数据分析:每日报表");
		
		$("#jishi").click(function(){
			getReportData();
		});
		
        $("#serverId").change(function(){
            if ($("#serverId").val() == 0) {
                $("#sform").dialog({
                    height: 500,
                    width: 700,
                    buttons: {
                        "确认": function(){
                            var item = $(':radio[name="db"]:checked').val();
                            $("#serverId").val(item);
                            $(this).dialog("close");
                        },
                        "关闭": function(){
                            $(this).dialog("close");
                        }
                    }
                })
            }
        });
        
	});
	
	function getReportData(){
		$.ajax({
			type : 'POST',
			url : '{:U("RechargeReport/getReportData")}',
			dataType : 'json',
			data : {
				serverId : $("#serverId").val(),
				year : $('#year').val(),
				month:$('#month').val()
			},
			beforeSend : function() {
				$("#dtatr_body").html("<tr><td colspan='10'><img src='__IMG__/loading.gif'/></td></tr>");
			},
			success : function (data) {
				var list = data.list;
				if(list!=null&&list!='') {
					var tbody = "";
					var goldAll = 0;
					var c_amtAll = 0;
					var payamt_coins_all = 0;
					var pubacct_payamt_coins_all = 0;
					for(var i in list) {
						goldAll += parseInt(list[i]["gold"]);
						c_amtAll += parseInt(list[i]["c_amt"]);
						payamt_coins_all += parseInt(list[i]["payamt_coins"]);
						pubacct_payamt_coins_all += parseInt(list[i]["pubacct_payamt_coins"]);
						tbody += "<tr>";
						tbody += "<td>" + list[i]["date"] + "</td>";
						tbody += "<td>" + list[i]["first_paypeopelnum"] + "</td>";
						tbody += "<td>" + list[i]["first_gold"]+'('+list[i]["first_c_amt"]+'*'+list[i]["first_payamt_coins"]+'*'+list[i]["first_pubacct_payamt_coins"]+")</td>";
						if(list[i]["first_paypeopelnum"]==0){
							tbody += "<td>0</td>";
						}else {
							tbody += "<td>" + Math.round(list[i]["first_gold"]*100/list[i]["first_paypeopelnum"])/100  + "</td>";
						}
						tbody += "<td>" + list[i]["loginnum"] + "</td>";
						tbody += "<td>" + list[i]["paypeoplenum"] + "</td>";
						tbody += "<td>" + list[i]["paynum"] + "</td>";
						tbody += "<td>" + list[i]["gold"]+'('+list[i]["c_amt"]+'*'+list[i]["payamt_coins"] +'*'+list[i]["pubacct_payamt_coins"]+")</td>";
						tbody += "<td>" + Math.round(list[i]["gold"]*100/list[i]["paypeoplenum"])/100  + "</td>";
						if(list[i]["loginnum"]==0){
							tbody += "<td>0</td>";
						}else {
							tbody += "<td>" + Math.round(list[i]["gold"]*100/list[i]["loginnum"])/100 + "</td>";
						}
						tbody += "</tr>";
					}
					$("#dtatr_body").html(tbody);
					$("#dtatr_body tr:odd").css( "background-color", "#e0f0f0");
					$("#money").html(goldAll);
					$("#moneyother").html(c_amtAll+'*'+payamt_coins_all+'*'+pubacct_payamt_coins_all);
				}else {
					$("#dtatr_body").html("<tr><td colspan='10'>没有数据！</td></tr>");
				}
			},
			error : function () {
				$("#dtatr_body").html("<tr><td colspan='10'>请求失败！</td></tr>");
			}
		});
	}
	</script>
</body>
</html>