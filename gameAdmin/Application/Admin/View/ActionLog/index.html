<!DOCTYPE html>
<html>
<head>
<title>公告管理</title>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<link href="__CSS__/skin.css" rel="stylesheet" type="text/css">
<link href="__CSS__/jquery-ui.css" rel="stylesheet" type="text/css">
<style type="text/css">
<!--
body {
	margin-left: 0px;
	margin-top: 0px;
	margin-right: 0px;
	margin-bottom: 0px;
	background-color: #EEF2FB;
	font-size: 12px;
}
-->
</style>
</head>
<body>
	<div>
		<div>
			<div>
				<table class="explain">
					<thead>
					</thead>
					<tbody style="font-family: Mingliu">
						<tr>
							<td width="5%" class="tableleft">
								<b>说明：</b>
							</td>
						</tr>
						<tr>
							<td width="95%" class="tableleft">1、查询GM相关操作历史记录</td>
						</tr>
					</tbody>
				</table>
			</div>

			<div class="topinfo">
				<div>
					<span>服务器:</span>
					<select id="serverId">
						<volist name="serverList" id="sl">
						<option value="{$sl['g_id']}">{$sl['g_name']}</option>
						</volist>
						<option value="0">全部</option>
					</select>
					<span>操作用户</span>
					<span><input type="text" value="" id="operate"/></span>
					<span style="margin-left: 20px">日期:</span>
					<input type="text" id="startdate" class="input1" value="{$today}" />
					至
					<input type="text" id="enddate" class="input1" value="{$today}" />
					<input type="button" value="查询" id="querybtn" />
				</div>
			</div>

			<div style="clear: both"></div>

			<div>
				<table class="mytable" cellspacing="0" align="center" id="dtable">
					<thead>
						<tr>
							<th>操作人</th>
							<th>操作名称</th>
							<th>备注</th>
							<th>操作时间</th>
						</tr>
					</thead>
					<tbody id="dtatr_body">
					</tbody>
				</table>
			</div>

                <div id="pagehtml" style="float:right;margin-right:20px">
                </div>
                <div id="example_length" class="dataTables_length" style="display:none">
                    <label>
                        每页显示
                        <select id="menu" name="example_length" size="1" aria-controls="example">
                            <option value="10" selected="selected">10</option>
                            <option value="25">25</option>
                            <option value="50">50</option>
                            <option value="100">100</option>
                        </select>
                        条记录
                    </label>
                </div>

			<div style="clear: both"></div>
		</div>

		<div style="height: 50px">&nbsp;</div>

	</div>

		<!-- 服务器 -->
        <div id="sform" style="display:none">
            <div class="ajaxform">
                <table width="100%" border="0" cellspacing="0" cellpadding="0" style="table-layout:fixed;">
				<tr>
					<td>
					<volist name="serverList" id="sld" key="k">
                        <if condition="$k%5 eq 0">
                            <br/>
                            <br/>
                        </if>
                        <input type="radio" name="db" value="{$sld['g_id']}" class="cbox" id="s{$k}"/>
                        <label for="s{$k}">
                            {$sld['g_name']}
                        </label>
                        <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
                    </volist>
					</td>
				</tr>
                </table>
            </div>
        </div>

	<script src="__STATIC__/jquery.js" type="text/javascript">
    </script>
	<script src="__JS__/jquery-ui.js" type="text/javascript">
    </script>
	<script src="__JS__/function.js" type="text/javascript">
    </script>
	<script type="text/javascript">
	$(document).ready(function(){
		//时间插件
		$("#startdate").datepicker();
		$("#enddate").datepicker();
		
		showTitle("GM工具:GM操作记录");
		
        $("#serverId").change(function(){
            if ($("#serverId").val() == 0) {
                $("#sform").dialog({
                    height: 500,
                    width: 700,
                    buttons: {
                        "确认": function(){
                            var item = $(':radio[name="db"]:checked').val();
                            $("#serverId").val(item);
                            $(this).dialog("close");
                        },
                        "关闭": function(){
                            $(this).dialog("close");
                        }
                    }
                })
            }
        });
        
        $('#menu').change(function(){
        	getActionLogList(1);
        });
		
		$("#querybtn").click(function() {
			getActionLogList(1);
		});
		
	});
		
			
		function getActionLogList(page) {
			if($("#startdate").val()>$("#enddate").val()){
				alert('查询日期不正确！');return false;
			}
			$.ajax({
						'type' : 'POST',
						url : '{:U("ActionLog/getActionLogList")}',
						dataType : 'json',
						data : {
							startdate : $("#startdate").val(),
							enddate : $("#enddate").val(),
							serverId : $("#serverId").val(),
							operate : $("#operate").val(),
							curPage:page,
							pageSize:$('#menu').val()
						},
						beforeSend : function() {
							$("#dtatr_body").html("<tr><td colspan='6'><img src='__IMG__/loading.gif'/></td></tr>");
						},
						success : function(data) {
							if(data.status==0){
								alert(data.info);return false;
							}
							var list = data.list;
							var serverList = data.serverList;
							if (list != ''&&list!=null){
								var html = '';
								for(var i in list){
									html += "<tr>";
									html += "<td>"+list[i]['operate']+"</td>";
									html += "<td>"+data.typeArr[list[i]['type']]+"</td>";
									html += "<td>"+list[i]['remark']+"</td>";
									html += "<td>"+list[i]['datetime']+"</td>";
									html += "</tr>";
								}
								$('#dtatr_body').html(html);
                                $("#dtatr_body tr:odd").css("background-color", "#e4eefa");
								$("#pagehtml").html(data.pageHtml);
								$("#pagehtml").show();
								$('#example_length').show();
							} else {
								$("#pagehtml").hide();
								$('#example_length').hide();
								$("#dtatr_body").html("<tr><td colspan='8'>没有数据！</td></tr>");
							}
						},
						error : function() {
							alert('请求失败');
						}
					});
		}
		
        //跳到相应页面 
        var go = function(){
            var pagenum = $("#page").val();
            if (pagenum == '' || isNaN(pagenum) || pagenum <= 0) {
                alert('请输入一个正整数！');
                $("#npage").val(1);
            }
            else {
            	getActionLogList(pagenum);
            }
        }
	</script>
</body>
</html>